<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ§ª æ™¶åœ“è¦†è“‹ç‡æ¨¡æ“¬å™¨ï½œå«æå£æ™¶ç‰‡</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <style>
    body{font-family:'Microsoft JhengHei',sans-serif;background:#fffaf6;color:#4e342e;margin:0;padding:0}
    *{box-sizing:border-box;}input,select,textarea{max-width:100%;}
    header{text-align:center;padding:20px}
    h1{color:#ff7043}
    .wrap{width:min(1100px,95vw);margin:0 auto;display:grid;grid-template-columns:1fr;gap:20px}
    @media(min-width:1200px){.wrap{grid-template-columns:400px 1fr}}
    .card{background:#fff;border:1px solid #f3d8c8;border-radius:12px;padding:16px;box-shadow:0 5px 15px rgba(255,112,67,.15)}
    label{font-weight:bold;display:block;margin-bottom:6px}
    input[type=range]{width:100%}
    .kpi{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-top:12px}
    .kpi .box{border:1px dashed #f3b9a0;border-radius:8px;padding:8px;background:#fffdfb}
    .kpi .val{font-size:1.5em;font-weight:bold;color:#43a047}
    canvas{width:100%;height:auto;border:1px solid #f3d8c8;border-radius:10px;margin-top:10px;background:#fff}
  </style>
</head>
<body>
  <body>
  <script>
    var password = "9527"; // åœ¨é€™è£¡è¨­å®šä½ çš„å¯†ç¢¼
    var passwordInput = prompt("è«‹è¼¸å…¥å¯†ç¢¼ä»¥å­˜å–æ­¤é é¢ï¼š");

    if (passwordInput === password) {
        // å¦‚æœå¯†ç¢¼æ­£ç¢ºï¼Œé¡¯ç¤ºé é¢å…§å®¹
        document.body.style.display = "block";
    } else {
        // å¦‚æœå¯†ç¢¼éŒ¯èª¤ï¼Œéš±è—é é¢æˆ–å°å‘éŒ¯èª¤é é¢
        alert("å¯†ç¢¼éŒ¯èª¤ï¼Œç„¡æ³•å­˜å–ã€‚");
        window.location.href = "about:blank"; // å°å‘ç©ºç™½é é¢
    }
</script>

<style>
    body {
        display: none; /* é è¨­å…ˆéš±è—é é¢å…§å®¹ */
    }
</style>
<header>
  <h1><i class="bi bi-cpu"></i> æ™¶åœ“è¦†è“‹ç‡æ¨¡æ“¬å™¨ âœ¨</h1>
  <p>æ™¶åœ“å¤§å°æœƒä¾ç…§ 12 å‹åŸºæº–ç¸®å°é¡¯ç¤ºï¼Œä¸¦å¯æ¨¡æ“¬æå£æ™¶ç‰‡</p>
</header>
<main class="wrap">
  <section class="card">
    <label for="edge">é‚Šç·£æ’é™¤ï¼š <span id="edgeLabel">1 mm</span></label>
    <input type="range" id="edge" min="0" max="5" step="1" value="1">

    <label for="kerf">åˆ‡å‰²é“å¯¬ï¼š <span id="kerfLabel">0.5 mm</span></label>
    <input type="range" id="kerf" min="0" max="4" step="1" value="1">

    <label for="dieSize">æ™¶ç‰‡é‚Šé•·ï¼š <span id="dieLabel">30 mm</span></label>
    <input type="range" id="dieSize" min="0" max="4" step="1" value="4">

    <label for="wafer">æ™¶åœ“ç›´å¾‘ï¼š <span id="waferLabel">6å‹ (150 mm)</span></label>
    <input type="range" id="wafer" min="0" max="2" step="1" value="0">

    <label for="badChips">æå£æ™¶ç‰‡æ•¸ï¼š <span id="badLabel">0</span></label>
    <input type="range" id="badChips" min="0" max="20" step="1" value="0">
  </section>
  <section class="card">
    <div class="kpi">
      <div class="box"><div>æ™¶ç‰‡æ•¸</div><div id="diesGrid" class="val">â€”</div></div>
      <div class="box"><div>æå£æ™¶ç‰‡æ•¸</div><div id="badCount" class="val">â€”</div></div>
      <div class="box"><div>è‰¯ç‡</div><div id="yieldRate" class="val">â€”</div></div>
      <div class="box"><div>è¦†è“‹ç‡</div><div id="coverageRate" class="val">â€”</div></div>
      <div class="box"><div>æµªè²»ç‡</div><div id="wasteRate" class="val">â€”</div></div>
    </div>
    <canvas id="waferCanvas" width="600" height="600"></canvas>
  </section>
</main>
<script>
const $=id=>document.getElementById(id);
const canvas=$("waferCanvas"),ctx=canvas.getContext("2d");

// åŸºæº–è¨­å®šï¼š12å‹ = 300 mm
const baseWafer=300;

const waferOptions=[150,200,300]; // mm (6å‹, 8å‹, 12å‹)
const waferLabels=["6å‹ (150 mm)","8å‹ (200 mm)","12å‹ (300 mm)"];
const kerfOptions=[0,0.5,1,1.5,2];
const dieOptions=[7,11,15,23,30]; // æ™¶ç‰‡é‚Šé•·

let diePositions=[]; // å„²å­˜æ¯å€‹æ™¶ç‰‡çš„åº§æ¨™ï¼Œç”¨ä¾†æ¨™è¨˜æå£

// æ›´æ–° label
$("wafer").addEventListener("input",()=>{$("waferLabel").textContent=waferLabels[$("wafer").value];simulate();});
$("edge").addEventListener("input",()=>{$("edgeLabel").textContent=$("edge").value+" mm";simulate();});
$("kerf").addEventListener("input",()=>{$("kerfLabel").textContent=kerfOptions[$("kerf").value]+" mm";simulate();});
$("dieSize").addEventListener("input",()=>{$("dieLabel").textContent=dieOptions[$("dieSize").value]+" mm";simulate();});
$("badChips").addEventListener("input",()=>{$("badLabel").textContent=$("badChips").value;simulate();});

function computeScale(){return (canvas.width-40)/baseWafer;} // æ°¸é ä»¥12å‹åŸºæº–ç¸®æ”¾

function drawWafer(D,edge){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const scale=computeScale(),c=canvas.width/2;
  const R=(D/2)*scale,Reff=(D/2-edge)*scale;
  ctx.fillStyle="#ffe9df";ctx.beginPath();ctx.arc(c,c,R,0,2*Math.PI);ctx.fill();
  ctx.fillStyle="#ffd0bf";ctx.beginPath();ctx.arc(c,c,Reff,0,2*Math.PI);ctx.fill();
  return{c,scale,Reff}
}

function rectInCircle(cx,cy,r,x,y,w,h){
  return [[x,y],[x+w,y],[x,y+h],[x+w,y+h]].every(([px,py])=> (px-cx)**2+(py-cy)**2<=r**2);
}

function simulate(){
  const D=waferOptions[Number($("wafer").value)];
  const edge=Number($("edge").value);
  const kerf=kerfOptions[Number($("kerf").value)];
  const dieLen=dieOptions[Number($("dieSize").value)];
  const badInput=Number($("badChips").value);

  const {c,scale,Reff}=drawWafer(D,edge);

  const step=(dieLen+kerf),effR=(D/2-edge),waferArea=Math.PI*effR**2,dieA=dieLen**2;
  let count=0;
  diePositions=[];
  ctx.strokeStyle="#ff7043";ctx.fillStyle="rgba(255,112,67,.6)";
  
  const maxSteps=Math.floor(effR/step);
  for(let iy=-maxSteps;iy<=maxSteps;iy++){
    for(let ix=-maxSteps;ix<=maxSteps;ix++){
      const x=ix*step,y=iy*step;
      if(rectInCircle(0,0,Reff,x*scale,y*scale,dieLen*scale,dieLen*scale)){
        ctx.fillRect(c+x*scale,c+y*scale,dieLen*scale,dieLen*scale);
        diePositions.push({x:c+x*scale,y:c+y*scale,size:dieLen*scale});
        count++;
      }
    }
  }

  // é™åˆ¶æå£æ™¶ç‰‡æ•¸ <= æ™¶ç‰‡æ•¸
  const badCount=Math.min(badInput,count);
  $("badChips").max=count; // å‹•æ…‹èª¿æ•´ä¸Šé™
  $("badLabel").textContent=badCount;

  // éš¨æ©ŸæŒ‘é¸å£æ™¶ç‰‡
  let chosen=new Set();
  while(chosen.size<badCount){
    chosen.add(Math.floor(Math.random()*diePositions.length));
  }
  ctx.strokeStyle="red";ctx.lineWidth=2;
  for(let idx of chosen){
    let d=diePositions[idx];
    ctx.beginPath();
    ctx.moveTo(d.x,d.y);
    ctx.lineTo(d.x+d.size,d.y+d.size);
    ctx.moveTo(d.x+d.size,d.y);
    ctx.lineTo(d.x,d.y+d.size);
    ctx.stroke();
  }

  $("diesGrid").textContent=count;
  $("badCount").textContent=badCount;
  $("yieldRate").textContent=(count>0?((count-badCount)/count*100).toFixed(2):0)+"%";
  const coverage=(count*dieA/waferArea);
  $("coverageRate").textContent=(coverage*100).toFixed(2)+"%";
  $("wasteRate").textContent=((1-coverage)*100).toFixed(2)+"%";
}
window.onload=simulate;
</script>
</body>
</html>
